<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Drag Into Text Question Template -->
    <template id="drag_into_text_question_template">
        <div class="quiz-drag-into-text-container" t-att-data-question-id="question.id">
            <div class="quiz-text-template" t-att-id="'text-template-' + str(question.id)"/>
            
            <div class="token-bank">
                <t t-foreach="question.dragtoken_ids" t-as="token">
                    <div class="draggable" 
                         t-att-data-value="token.label" 
                         t-att-data-blank="token.blank_number">
                        <t t-esc="token.label"/>
                    </div>
                </t>
            </div>
            
            <input type="hidden" t-att-name="'question_' + str(question.id)" 
                   class="drag-into-text-result" value="{}" />
        </div>
        
        <script type="text/javascript">
            (function() {
                // Process template text and insert dropzones
                var textTemplate = document.getElementById("text-template-<t t-esc='question.id'/>");
                var templateHtml = "<t t-esc='question.text_template'/>";
                
                // Replace {{n}} with dropzones
                textTemplate.innerHTML = templateHtml.replace(/\{\{(\d+)\}\}/g, function(match, number) {
                    return '&lt;div class="dropzone" data-target="' + number + '">&lt;/div>';
                });
                
                // Decode the HTML entities
                textTemplate.innerHTML = textTemplate.innerHTML
                    .replace(/&lt;/g, '<')
                    .replace(/&gt;/g, '>');
            })();
        </script>
    </template>
    
    <!-- Include styles and scripts -->
    <template id="assets_frontend" inherit_id="web.assets_frontend">
        <xpath expr="." position="inside">
            <link rel="stylesheet" href="/quiz_custom/static/src/css/drag_into_text.css"/>
            <script type="text/javascript" src="/quiz_custom/static/src/js/drag_into_text.js"/>
        </xpath>
    </template>
</odoo>
