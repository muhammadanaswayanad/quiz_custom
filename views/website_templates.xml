<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Quiz List Template -->
    <template id="quiz_list" name="Quiz List">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-8 offset-lg-2">
                            <h1 class="text-center mb-4">Available Quizzes</h1>
                            <t t-if="not quizzes">
                                <div class="alert alert-info text-center">
                                    <h4>No quizzes available at the moment</h4>
                                    <p>Please check back later for new quizzes.</p>
                                </div>
                            </t>
                            <t t-else="">
                                <div class="row">
                                    <t t-foreach="quizzes" t-as="quiz">
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-body">
                                                    <h5 class="card-title" t-field="quiz.name"/>
                                                    <p class="card-text" t-field="quiz.description"/>
                                                    <div class="quiz-info">
                                                        <small class="text-muted">
                                                            <i class="fa fa-question-circle"/> <t t-esc="quiz.total_questions"/> questions
                                                            <t t-if="quiz.time_limit">
                                                                | <i class="fa fa-clock-o"/> <t t-esc="quiz.time_limit"/> minutes
                                                            </t>
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="card-footer">
                                                    <a t-attf-href="/quiz/#{quiz.slug}" class="btn btn-primary btn-block">
                                                        Start Quiz
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Quiz Detail Template -->
    <template id="quiz_detail" name="Quiz Detail">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-8 offset-lg-2">
                            <div class="text-center mb-4">
                                <h1 t-field="quiz.name"/>
                                <div class="quiz-description" t-field="quiz.description"/>
                            </div>
                            
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Quiz Information</h5>
                                    <ul class="list-unstyled">
                                        <li><strong>Questions:</strong> <t t-esc="quiz.total_questions"/></li>
                                        <li><strong>Total Points:</strong> <t t-esc="quiz.total_points"/></li>
                                        <t t-if="quiz.time_limit">
                                            <li><strong>Time Limit:</strong> <t t-esc="quiz.time_limit"/> minutes</li>
                                        </t>
                                        <li><strong>Passing Score:</strong> <t t-esc="quiz.passing_score"/>%</li>
                                    </ul>
                                    
                                    <form t-attf-action="/quiz/#{quiz.slug}/start" method="post" class="mt-4">
                                        <div class="form-group mb-3">
                                            <label for="participant_name">Your Name *</label>
                                            <input type="text" name="participant_name" class="form-control" required="required"/>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="participant_email">Email (Optional)</label>
                                            <input type="email" name="participant_email" class="form-control"/>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-lg w-100">
                                            Start Quiz
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Quiz Question Template -->
    <template id="quiz_question" name="Quiz Question">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-10 offset-lg-1">
                            <div class="quiz-header mb-4">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h2 t-field="quiz.name"/>
                                        <p class="text-muted">Participant: <t t-esc="session.participant_name"/></p>
                                    </div>
                                    <div class="col-md-4 text-right">
                                        <div class="progress mb-2">
                                            <div class="progress-bar" role="progressbar" 
                                                 t-attf-style="width: #{(question_index + 1) / len(quiz.question_ids) * 100}%"/>
                                        </div>
                                        <small class="text-muted">
                                            Question <t t-esc="question_index + 1"/> of <t t-esc="len(quiz.question_ids)"/>
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-body">
                                    <div class="question-content mb-4">
                                        <h4>Question <t t-esc="question_index + 1"/></h4>
                                        <div t-field="question.question_html"/>
                                        <small class="text-muted">Points: <t t-esc="question.points"/></small>
                                    </div>
                                    
                                    <form method="post" class="question-form">
                                        <input type="hidden" name="session" t-att-value="session.session_token"/>
                                        
                                        <!-- Multiple Choice Single -->
                                        <t t-if="question.type == 'mcq_single'">
                                            <div class="choices">
                                                <t t-foreach="question.choice_ids" t-as="choice">
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="radio" 
                                                               name="answer_data" t-att-value="choice.id" 
                                                               t-att-id="'choice_%s' % choice.id"/>
                                                        <label class="form-check-label" t-att-for="'choice_%s' % choice.id">
                                                            <t t-esc="choice.text"/>
                                                        </label>
                                                    </div>
                                                </t>
                                            </div>
                                        </t>
                                        
                                        <!-- Multiple Choice Multiple -->
                                        <t t-if="question.type == 'mcq_multiple'">
                                            <div class="choices">
                                                <t t-foreach="question.choice_ids" t-as="choice">
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" 
                                                               name="answer_data" t-att-value="choice.id" 
                                                               t-att-id="'choice_%s' % choice.id"/>
                                                        <label class="form-check-label" t-att-for="'choice_%s' % choice.id">
                                                            <t t-esc="choice.text"/>
                                                        </label>
                                                    </div>
                                                </t>
                                            </div>
                                        </t>
                                        
                                        <!-- Fill in the Blanks -->
                                        <t t-if="question.type == 'fill_blanks'">
                                            <div class="fill-blanks">
                                                <p>Fill in the missing words:</p>
                                                <t t-foreach="question.fill_blank_answer_ids" t-as="blank">
                                                    <div class="form-group mb-3">
                                                        <label>Blank <t t-esc="blank.blank_number"/>:</label>
                                                        <input type="text" class="form-control" 
                                                               t-att-name="'blank_%s' % blank.blank_number" 
                                                               placeholder="Enter your answer"/>
                                                    </div>
                                                </t>
                                            </div>
                                        </t>
                                        
                                        <!-- Drag into Zones -->
                                        <t t-if="question.type == 'drag_zone'">
                                            <div class="drag-zones-container">
                                                <p><strong>Instructions:</strong> Drag the tokens below into the correct zones.</p>
                                                
                                                <!-- Drop Zones -->
                                                <div class="drop-zones mb-4">
                                                    <div class="row">
                                                        <t t-set="unique_zones" t-value="list(set(question.drag_token_ids.mapped('correct_for_blank')))"/>
                                                        <t t-foreach="unique_zones" t-as="zone_num">
                                                            <div class="col-md-4 mb-3">
                                                                <div class="drop-zone border rounded p-3 text-center" 
                                                                     t-att-data-zone="zone_num"
                                                                     style="min-height: 80px; background-color: #f8f9fa; border: 2px dashed #dee2e6;">
                                                                    <h6>Zone <t t-esc="zone_num"/></h6>
                                                                    <div class="dropped-items"></div>
                                                                </div>
                                                            </div>
                                                        </t>
                                                    </div>
                                                </div>
                                                
                                                <!-- Draggable Tokens -->
                                                <div class="drag-tokens">
                                                    <p><strong>Available Tokens:</strong></p>
                                                    <div class="tokens-container d-flex flex-wrap">
                                                        <t t-foreach="question.drag_token_ids" t-as="token">
                                                            <div class="drag-token btn btn-outline-primary m-1" 
                                                                 draggable="true"
                                                                 t-att-data-token="token.text"
                                                                 t-att-data-correct-zone="token.correct_for_blank">
                                                                <t t-esc="token.text"/>
                                                            </div>
                                                        </t>
                                                    </div>
                                                </div>
                                                
                                                <!-- Hidden input to store answer -->
                                                <input type="hidden" name="answer_data" id="drag_zone_answer"/>
                                            </div>
                                        </t>
                                        
                                        <!-- Drag into Text -->
                                        <t t-if="question.type == 'drag_into_text'">
                                            <div class="drag-into-text-container">
                                                <p><strong>Instructions:</strong> Drag the tokens below into the correct positions in the text.</p>
                                                
                                                <!-- Text with drop zones (placeholders will be replaced with drop zones) -->
                                                <div class="text-with-blanks mb-4 p-3 border rounded" 
                                                     t-att-data-question-html="question.question_html">
                                                    <!-- JavaScript will process this -->
                                                </div>
                                                
                                                <!-- Draggable Tokens -->
                                                <div class="drag-tokens">
                                                    <p><strong>Available Tokens:</strong></p>
                                                    <div class="tokens-container d-flex flex-wrap">
                                                        <t t-foreach="question.drag_token_ids" t-as="token">
                                                            <div class="drag-token btn btn-outline-success m-1" 
                                                                 draggable="true"
                                                                 t-att-data-token="token.text"
                                                                 t-att-data-correct-blank="token.correct_for_blank">
                                                                <t t-esc="token.text"/>
                                                            </div>
                                                        </t>
                                                    </div>
                                                </div>
                                                
                                                <!-- Hidden input to store answer -->
                                                <input type="hidden" name="answer_data" id="drag_text_answer"/>
                                            </div>
                                        </t>
                                        
                                        <!-- Matching Questions -->
                                        <t t-if="question.type == 'match'">
                                            <div class="matching-container">
                                                <p><strong>Instructions:</strong> Match the items on the left with the correct items on the right.</p>
                                                
                                                <div class="row">
                                                    <!-- Left side items -->
                                                    <div class="col-md-6">
                                                        <h6>Match these:</h6>
                                                        <div class="left-items">
                                                            <t t-foreach="question.match_pair_ids" t-as="pair">
                                                                <div class="match-item-left btn btn-outline-info d-block mb-2 text-left" 
                                                                     draggable="true"
                                                                     t-att-data-pair-id="pair.id"
                                                                     t-att-data-left-text="pair.left_text">
                                                                    <t t-esc="pair.left_text"/>
                                                                </div>
                                                            </t>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Right side drop zones -->
                                                    <div class="col-md-6">
                                                        <h6>With these:</h6>
                                                        <div class="right-items">
                                                            <t t-foreach="question.match_pair_ids" t-as="pair">
                                                                <div class="match-drop-zone border rounded p-2 mb-2 text-center" 
                                                                     t-att-data-pair-id="pair.id"
                                                                     t-att-data-right-text="pair.right_text"
                                                                     style="min-height: 50px; background-color: #f8f9fa;">
                                                                    <div class="fixed-text"><t t-esc="pair.right_text"/></div>
                                                                    <div class="dropped-match"></div>
                                                                </div>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Hidden input to store answer -->
                                                <input type="hidden" name="answer_data" id="matching_answer"/>
                                            </div>
                                        </t>
                                        
                                        <!-- Default fallback for other question types -->
                                        <t t-if="question.type not in ['mcq_single', 'mcq_multiple', 'fill_blanks', 'drag_zone', 'drag_into_text', 'match']">
                                            <div class="alert alert-info">
                                                <p>This question type (<t t-esc="question.type"/>) is not yet implemented in the frontend.</p>
                                                <textarea name="answer_data" class="form-control" placeholder="Enter your answer here..."></textarea>
                                            </div>
                                        </t>
                                        
                                        <div class="question-navigation mt-4">
                                            <div class="row">
                                                <div class="col-6">
                                                    <t t-if="question_index > 0">
                                                        <a t-attf-href="/quiz/#{quiz.slug}/question/#{question_index}?session=#{session.session_token}" 
                                                           class="btn btn-secondary">Previous</a>
                                                    </t>
                                                </div>
                                                <div class="col-6 text-right">
                                                    <button type="submit" class="btn btn-primary">
                                                        <t t-if="question_index + 1 == len(quiz.question_ids)">
                                                            Complete Quiz
                                                        </t>
                                                        <t t-else="">
                                                            Next Question
                                                        </t>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Quiz Results Template -->
    <template id="quiz_results" name="Quiz Results">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-8 offset-lg-2">
                            <div class="text-center mb-4">
                                <h1>Quiz Complete!</h1>
                                <h2 t-field="session.quiz_id.name"/>
                            </div>
                            
                            <div class="card">
                                <div class="card-body text-center">
                                    <h3>Your Results</h3>
                                    <div class="result-score mb-4">
                                        <div class="score-display">
                                            <span class="score-number"><t t-esc="session.total_score or 0"/></span>
                                            <span class="score-total">/ <t t-esc="max_score or 0"/></span>
                                        </div>
                                        <div class="score-percentage">
                                            <t t-esc="'%.1f' % (session.percentage or 0)"/>%
                                        </div>
                                        <div t-att-class="'result-status ' + ('passed' if session.passed else 'failed')">
                                            <t t-if="session.passed">
                                                <i class="fa fa-check-circle"/> Passed!
                                            </t>
                                            <t t-else="">
                                                <i class="fa fa-times-circle"/> Not Passed
                                            </t>
                                        </div>
                                    </div>
                                    
                                    <div class="participant-info">
                                        <p><strong>Participant:</strong> <t t-esc="session.participant_name"/></p>
                                        <p><strong>Completed:</strong> <t t-esc="session.end_time"/></p>
                                    </div>
                                    
                                    <a href="/quiz" class="btn btn-primary">Take Another Quiz</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
