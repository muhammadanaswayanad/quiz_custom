<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Quiz List Template -->
    <template id="quiz_list" name="Quiz List">
        <t t-call="website.layout">
            <div class="container mt-4">
                <h1>Available Quizzes</h1>
                <div class="row">
                    <t t-foreach="quizzes" t-as="quiz">
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title" t-field="quiz.name"/>
                                    <p class="card-text" t-field="quiz.description"/>
                                    <div class="quiz-meta">
                                        <small class="text-muted">
                                            <i class="fa fa-question-circle"/> <t t-esc="quiz.total_questions"/> questions
                                            <i class="fa fa-star ml-2"/> <t t-esc="quiz.total_points"/> points
                                        </small>
                                    </div>
                                    <a t-attf-href="/quiz/#{quiz.slug}" class="btn btn-primary mt-2">Take Quiz</a>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- Quiz Start Template -->
    <template id="quiz_start" name="Quiz Start">
        <t t-call="website.layout">
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h2 t-field="quiz.name"/>
                            </div>
                            <div class="card-body">
                                <div t-field="quiz.description"/>
                                <div class="quiz-info mt-4">
                                    <p><strong>Questions:</strong> <t t-esc="quiz.total_questions"/></p>
                                    <p><strong>Total Points:</strong> <t t-esc="quiz.total_points"/></p>
                                    <p t-if="quiz.time_limit"><strong>Time Limit:</strong> <t t-esc="quiz.time_limit"/> minutes</p>
                                    <p><strong>Passing Score:</strong> <t t-esc="quiz.passing_score"/>%</p>
                                </div>
                                <form method="post" t-attf-action="/quiz/#{quiz.slug}/take">
                                    <div class="form-group">
                                        <label for="participant_name">Name</label>
                                        <input type="text" class="form-control" name="participant_name" required="required"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="participant_email">Email (optional)</label>
                                        <input type="email" class="form-control" name="participant_email"/>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-lg">Start Quiz</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Quiz Taking Template -->
    <template id="quiz_take" name="Quiz Take">
        <t t-call="website.layout">
            <div class="container-fluid quiz-container">
                <div class="quiz-header">
                    <h3 t-field="quiz.name"/>
                    <div class="quiz-progress">
                        Question <span id="current-question">1</span> of <t t-esc="len(questions)"/>
                    </div>
                    <div id="timer" t-if="quiz.time_limit"/>
                </div>
                
                <div class="quiz-content">
                    <t t-foreach="questions" t-as="question">
                        <div t-attf-class="question-container #{'' if question_index == 0 else 'd-none'}" 
                             t-attf-data-question-id="#{question.id}">
                            <div class="question-text" t-field="question.question_html"/>
                            
                            <!-- MCQ Single -->
                            <div t-if="question.type == 'mcq_single'" class="mcq-options">
                                <t t-foreach="question.choice_ids" t-as="choice">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" 
                                               t-attf-name="question_#{question.id}" 
                                               t-attf-value="#{choice.id}"/>
                                        <label class="form-check-label" t-field="choice.text"/>
                                    </div>
                                </t>
                            </div>
                            
                            <!-- MCQ Multiple -->
                            <div t-if="question.type == 'mcq_multi'" class="mcq-options">
                                <t t-foreach="question.choice_ids" t-as="choice">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               t-attf-name="question_#{question.id}[]" 
                                               t-attf-value="#{choice.id}"/>
                                        <label class="form-check-label" t-field="choice.text"/>
                                    </div>
                                </t>
                            </div>
                            
                            <!-- Drag Into Text -->
                            <div t-if="question.type == 'drag_into_text'" class="drag-into-text">
                                <div class="question-with-blanks" t-field="question.question_html"/>
                                <div class="drag-tokens">
                                    <t t-foreach="question.drag_token_ids" t-as="token">
                                        <div class="token" t-attf-data-value="#{token.label}" 
                                             t-esc="token.label"/>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
                
                <div class="quiz-navigation">
                    <button id="prev-btn" class="btn btn-secondary" disabled="disabled">Previous</button>
                    <button id="next-btn" class="btn btn-primary">Next</button>
                    <button id="submit-btn" class="btn btn-success d-none">Submit Quiz</button>
                </div>
            </div>
            
            <script>
                var sessionToken = '<t t-esc="session.session_token"/>';
                var totalQuestions = <t t-esc="len(questions)"/>;
            </script>
        </t>
    </template>

    <!-- Quiz Results Template -->
    <template id="quiz_results" name="Quiz Results">
        <t t-call="website.layout">
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h2>Quiz Results</h2>
                            </div>
                            <div class="card-body">
                                <div class="results-summary">
                                    <h4>Your Score: <t t-esc="session.total_score"/> / <t t-esc="session.max_score"/></h4>
                                    <h5>Percentage: <t t-esc="round(session.percentage, 1)"/>%</h5>
                                    <div t-attf-class="alert #{session.passed and 'alert-success' or 'alert-danger'}">
                                        <t t-if="session.passed">
                                            <i class="fa fa-check-circle"/> Congratulations! You passed the quiz.
                                        </t>
                                        <t t-else="">
                                            <i class="fa fa-times-circle"/> You did not meet the passing score of <t t-esc="session.quiz_id.passing_score"/>%.
                                        </t>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <a href="/quiz" class="btn btn-primary">Take Another Quiz</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
